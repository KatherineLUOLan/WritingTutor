{"ast":null,"code":"var _jsxFileName = \"/Users/primopan/WebstormProjects/luolan/WritingTutor/src/App.tsx\",\n  _s = $RefreshSig$(),\n  _s2 = $RefreshSig$();\nimport { useState, useRef } from 'react';\nimport ReactQuill from 'react-quill';\nimport 'react-quill/dist/quill.snow.css';\nimport './App.css';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst API_BASE = 'http://10.30.9.1';\n\n/** ----------- 类型 ----------- */\n\n/** ----------- 组件 ----------- */\nfunction AudioPlayer({\n  file\n}) {\n  _s();\n  const [duration, setDuration] = useState('00:00');\n  const [currentTime, setCurrentTime] = useState('00:00');\n  const [isPlaying, setIsPlaying] = useState(false);\n  const audioRef = useRef(null);\n  const formatTime = time => {\n    const minutes = Math.floor(time / 60);\n    const seconds = Math.floor(time % 60);\n    return `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;\n  };\n  const handleLoadedMetadata = () => {\n    if (audioRef.current) setDuration(formatTime(audioRef.current.duration));\n  };\n  const handleTimeUpdate = () => {\n    if (audioRef.current) setCurrentTime(formatTime(audioRef.current.currentTime));\n  };\n  const togglePlay = () => {\n    const el = audioRef.current;\n    if (!el) return;\n    if (isPlaying) el.pause();else el.play();\n    setIsPlaying(p => !p);\n  };\n  const handleDownload = () => {\n    const url = URL.createObjectURL(file);\n    const a = document.createElement('a');\n    a.href = url;\n    a.download = file.name;\n    document.body.appendChild(a);\n    a.click();\n    a.remove();\n    URL.revokeObjectURL(url);\n  };\n  const pct = audioRef.current && audioRef.current.duration ? audioRef.current.currentTime / audioRef.current.duration * 100 : 0;\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"audio-player\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"audio-progress\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"time-info\",\n        children: [/*#__PURE__*/_jsxDEV(\"span\", {\n          className: \"current-time\",\n          children: currentTime\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 101,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n          className: \"duration\",\n          children: duration\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 102,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 100,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"progress-bar-container\",\n        children: [/*#__PURE__*/_jsxDEV(\"input\", {\n          type: \"range\",\n          className: \"progress-bar\",\n          value: pct,\n          onChange: e => {\n            const el = audioRef.current;\n            if (!el) return;\n            const next = Number(e.currentTarget.value) / 100 * el.duration;\n            el.currentTime = next;\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 105,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"audio-controls\",\n          children: [/*#__PURE__*/_jsxDEV(\"button\", {\n            className: `control-btn ${isPlaying ? 'pause' : 'play'}`,\n            onClick: togglePlay,\n            title: isPlaying ? '暂停' : '播放',\n            children: isPlaying ? '⏸' : '▶'\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 117,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            className: \"control-btn download\",\n            onClick: handleDownload,\n            title: \"\\u4E0B\\u8F7D\",\n            children: \"\\u2B07\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 124,\n            columnNumber: 25\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 116,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 104,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 99,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"audio\", {\n      ref: audioRef,\n      onLoadedMetadata: handleLoadedMetadata,\n      onTimeUpdate: handleTimeUpdate,\n      onEnded: () => setIsPlaying(false),\n      children: [/*#__PURE__*/_jsxDEV(\"source\", {\n        src: URL.createObjectURL(file),\n        type: file.type\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 136,\n        columnNumber: 17\n      }, this), \"Your browser does not support the audio element.\"]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 130,\n      columnNumber: 13\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 98,\n    columnNumber: 9\n  }, this);\n}\n\n/** ----------- 页面 ----------- */\n_s(AudioPlayer, \"I21p4VWxwJbL8D0dC+2pCe6iw4k=\");\n_c = AudioPlayer;\nexport default function App() {\n  _s2();\n  const [text, setText] = useState('');\n  const [chatInput, setChatInput] = useState('');\n  const [chatHistory, setChatHistory] = useState([]);\n  const [isLoading, setIsLoading] = useState(false);\n  const [steps, setSteps] = useState([{\n    id: 1,\n    name: 'Hook',\n    description: '吸引听众注意力的开场白'\n  }, {\n    id: 2,\n    name: 'Exploration',\n    description: '探索和解释研究内容'\n  }, {\n    id: 3,\n    name: 'Resolution',\n    description: '总结研究的影响和意义'\n  }]);\n  const [draggedStep, setDraggedStep] = useState(null);\n  const [isExecuted, setIsExecuted] = useState(false);\n  const [isDragging, setIsDragging] = useState(false);\n  const [hasGivenSuggestions, setHasGivenSuggestions] = useState(false);\n  const handleStepReorder = message => {\n    const numbers = message.match(/\\d+/g);\n    if (numbers && numbers.length === 3) {\n      const newOrder = numbers.map(num => parseInt(num, 10) - 1);\n      const newSteps = newOrder.map(index => steps[index]);\n      setSteps(newSteps);\n      return `步骤已调整为：\\n\\n1. ${newSteps[0].name}: ${newSteps[0].description}\\n2. ${newSteps[1].name}: ${newSteps[1].description}\\n3. ${newSteps[2].name}: ${newSteps[2].description}`;\n    }\n    return '请按照格式输入要调整的步骤顺序，例如：\"1 3 2\" 表示将第二步和第三步互换位置。';\n  };\n  const handleChatSubmit = async e => {\n    e.preventDefault();\n    if (!chatInput.trim()) return;\n    setChatHistory(prev => [...prev, {\n      role: 'user',\n      content: chatInput\n    }]);\n    const userInput = chatInput;\n    setChatInput('');\n\n    // 只在第一次输入后给出建议\n    if (!hasGivenSuggestions) {\n      setIsLoading(true);\n      try {\n        var _data$choices, _data$choices$, _data$choices$$messag, _content$match, _content$match$, _content$match2, _content$match2$, _content$match3, _content$match3$;\n        const resp = await fetch(`${API_BASE}/api/convert`, {\n          method: 'POST',\n          headers: {\n            'Content-Type': 'application/json'\n          },\n          body: JSON.stringify({\n            text: `请根据以下research内容，分别用如下格式严格给出三类建议，每条建议一行：\\nStorytelling: （一句建议）\\nMetaphor: （一句建议）\\nAnalogy: （一句建议）\\n内容：${userInput}\\n请严格按照上述格式输出。`\n          })\n        });\n        if (!resp.ok) throw new Error(`HTTP ${resp.status}`);\n        const data = await resp.json();\n        if (data.error) throw new Error(data.error);\n        const content = ((_data$choices = data.choices) === null || _data$choices === void 0 ? void 0 : (_data$choices$ = _data$choices[0]) === null || _data$choices$ === void 0 ? void 0 : (_data$choices$$messag = _data$choices$.message) === null || _data$choices$$messag === void 0 ? void 0 : _data$choices$$messag.content) || '';\n        const story = (_content$match = content.match(/Storytelling[:：](.*)/i)) === null || _content$match === void 0 ? void 0 : (_content$match$ = _content$match[1]) === null || _content$match$ === void 0 ? void 0 : _content$match$.trim();\n        const metaphor = (_content$match2 = content.match(/Metaphor[:：](.*)/i)) === null || _content$match2 === void 0 ? void 0 : (_content$match2$ = _content$match2[1]) === null || _content$match2$ === void 0 ? void 0 : _content$match2$.trim();\n        const analogy = (_content$match3 = content.match(/Analogy[:：](.*)/i)) === null || _content$match3 === void 0 ? void 0 : (_content$match3$ = _content$match3[1]) === null || _content$match3$ === void 0 ? void 0 : _content$match3$.trim();\n        let hasAny = false;\n        if (story) {\n          setChatHistory(prev => [...prev, {\n            role: 'assistant',\n            content: {\n              type: 'suggestion',\n              title: 'Storytelling 建议',\n              text: story\n            }\n          }]);\n          hasAny = true;\n        }\n        if (metaphor) {\n          setChatHistory(prev => [...prev, {\n            role: 'assistant',\n            content: {\n              type: 'suggestion',\n              title: 'Metaphor 隐喻建议',\n              text: metaphor\n            }\n          }]);\n          hasAny = true;\n        }\n        if (analogy) {\n          setChatHistory(prev => [...prev, {\n            role: 'assistant',\n            content: {\n              type: 'suggestion',\n              title: 'Analogy 类比建议',\n              text: analogy\n            }\n          }]);\n          hasAny = true;\n        }\n        if (!hasAny) {\n          setChatHistory(prev => [...prev, {\n            role: 'assistant',\n            content\n          }]);\n        }\n        setHasGivenSuggestions(true);\n      } catch (err) {\n        setChatHistory(prev => [...prev, {\n          role: 'error',\n          content: `Error: ${err.message}`\n        }]);\n      } finally {\n        setIsLoading(false);\n      }\n      return;\n    }\n\n    // 处理步骤调整的请求\n    if (userInput.toLowerCase().includes('调整步骤')) {\n      setChatHistory(prev => [...prev, {\n        role: 'assistant',\n        content: '请输入想要的步骤顺序（例如：1 3 2）：'\n      }]);\n      return;\n    }\n\n    // 检查是否是步骤顺序输入\n    if (/^\\d+\\s+\\d+\\s+\\d+$/.test(userInput)) {\n      const response = handleStepReorder(userInput);\n      setChatHistory(prev => [...prev, {\n        role: 'assistant',\n        content: response\n      }]);\n      return;\n    }\n\n    // 处理其他对话\n    setIsLoading(true);\n    try {\n      var _data$choices$0$messa, _data$choices2, _data$choices2$, _data$choices2$$messa;\n      const resp = await fetch(`${API_BASE}/api/convert`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({\n          text: userInput\n        })\n      });\n      if (!resp.ok) throw new Error(`HTTP ${resp.status}`);\n      const data = await resp.json();\n      if (data.error) throw new Error(data.error);\n      const content = (_data$choices$0$messa = (_data$choices2 = data.choices) === null || _data$choices2 === void 0 ? void 0 : (_data$choices2$ = _data$choices2[0]) === null || _data$choices2$ === void 0 ? void 0 : (_data$choices2$$messa = _data$choices2$.message) === null || _data$choices2$$messa === void 0 ? void 0 : _data$choices2$$messa.content) !== null && _data$choices$0$messa !== void 0 ? _data$choices$0$messa : '(no content)';\n      setChatHistory(prev => [...prev, {\n        role: 'assistant',\n        content\n      }]);\n    } catch (err) {\n      setChatHistory(prev => [...prev, {\n        role: 'error',\n        content: `Error: ${err.message}`\n      }]);\n    } finally {\n      setIsLoading(false);\n    }\n  };\n  const modules = {\n    toolbar: [[{\n      header: [1, 2, 3, false]\n    }], ['bold', 'italic', 'underline', 'strike'], [{\n      color: []\n    }, {\n      background: []\n    }], [{\n      font: []\n    }], [{\n      size: ['small', false, 'large', 'huge']\n    }], [{\n      align: []\n    }], ['clean']]\n  };\n  const handleDragStart = (e, step) => {\n    setDraggedStep(step);\n    e.currentTarget.classList.add('dragging');\n  };\n  const handleDragEnd = e => {\n    e.currentTarget.classList.remove('dragging');\n    notifyLLMOfStepChange(steps);\n  };\n  const handleDragOver = (e, _index) => {\n    e.preventDefault();\n    const stepBoxes = Array.from(document.querySelectorAll('.step-content-box'));\n    const afterElement = stepBoxes.reduce((closest, child) => {\n      const box = child.getBoundingClientRect();\n      const offset = e.clientY - box.top - box.height / 2;\n      if (offset < 0 && offset > closest.offset) return {\n        offset,\n        element: child\n      };\n      return closest;\n    }, {\n      offset: Number.NEGATIVE_INFINITY\n    }).element;\n    if (afterElement && draggedStep) {\n      const newSteps = [...steps];\n      const oldIndex = steps.findIndex(s => s.id === draggedStep.id);\n      const newIndex = steps.findIndex(s => s.id === Number(afterElement.dataset.stepId));\n      newSteps.splice(oldIndex, 1);\n      newSteps.splice(newIndex, 0, draggedStep);\n      setSteps(newSteps);\n    }\n  };\n  const notifyLLMOfStepChange = async newSteps => {\n    setIsLoading(true);\n    try {\n      var _data$choices3, _data$choices3$, _data$choices3$$messa;\n      const resp = await fetch(`${API_BASE}/api/convert`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({\n          text: 'steps_reordered',\n          steps: newSteps.map((s, i) => ({\n            position: i + 1,\n            name: s.name,\n            description: s.description\n          }))\n        })\n      });\n      if (!resp.ok) throw new Error(`HTTP ${resp.status}`);\n      const data = await resp.json();\n      if (data.error) throw new Error(data.error);\n      const content = (_data$choices3 = data.choices) === null || _data$choices3 === void 0 ? void 0 : (_data$choices3$ = _data$choices3[0]) === null || _data$choices3$ === void 0 ? void 0 : (_data$choices3$$messa = _data$choices3$.message) === null || _data$choices3$$messa === void 0 ? void 0 : _data$choices3$$messa.content;\n      if (content) {\n        setChatHistory(prev => [...prev, {\n          role: 'assistant',\n          content\n        }]);\n      }\n    } catch (err) {\n      setChatHistory(prev => [...prev, {\n        role: 'error',\n        content: `Error updating step order: ${err.message}`\n      }]);\n    } finally {\n      setIsLoading(false);\n    }\n  };\n  const handleModifySteps = () => {\n    setChatHistory(prev => [...prev, {\n      role: 'assistant',\n      content: '请拖拽调整步骤顺序。'\n    }]);\n  };\n  const handleExecute = () => {\n    setIsExecuted(true);\n    setChatHistory(prev => [...prev, {\n      role: 'assistant',\n      content: {\n        type: 'SecondStep',\n        dropzone: true,\n        text: '请将音频或视频文件拖拽到这里'\n      }\n    }]);\n  };\n  const handleFileDrop = e => {\n    e.preventDefault();\n    const files = Array.from(e.dataTransfer.files);\n    const media = files.filter(f => f.type.startsWith('audio/') || f.type.startsWith('video/'));\n    media.forEach(file => {\n      setChatHistory(prev => [...prev, {\n        role: 'assistant',\n        content: {\n          type: 'SecondStep',\n          fileType: file.type.startsWith('audio/') ? 'audio' : 'video',\n          fileName: file.name,\n          file\n        }\n      }]);\n    });\n  };\n  const renderMessage = msg => {\n    if (typeof msg.content === 'object') {\n      const c = msg.content;\n      if (c.type === 'FirstStep') {\n        return /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"first-step\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"message-text\",\n            children: c.text\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 362,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"steps-container\",\n            children: c.steps.map((step, index) => /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"step-box\",\n              children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"step-number\",\n                children: [\"Step \", index + 1]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 366,\n                columnNumber: 37\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"step-content-box\",\n                draggable: true,\n                \"data-step-id\": step.id,\n                onDragStart: e => handleDragStart(e, step),\n                onDragEnd: handleDragEnd,\n                onDragOver: e => handleDragOver(e, index),\n                children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"step-name\",\n                  children: step.name\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 375,\n                  columnNumber: 41\n                }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"step-description\",\n                  children: step.description\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 376,\n                  columnNumber: 41\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 367,\n                columnNumber: 37\n              }, this)]\n            }, step.id, true, {\n              fileName: _jsxFileName,\n              lineNumber: 365,\n              columnNumber: 33\n            }, this))\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 363,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"action-buttons\",\n            children: [/*#__PURE__*/_jsxDEV(\"button\", {\n              className: \"action-btn modify\",\n              onClick: handleModifySteps,\n              children: \"\\u4FEE\\u6539\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 382,\n              columnNumber: 29\n            }, this), !isExecuted ? /*#__PURE__*/_jsxDEV(\"button\", {\n              className: \"action-btn execute\",\n              onClick: handleExecute,\n              children: \"\\u6267\\u884C\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 384,\n              columnNumber: 33\n            }, this) : /*#__PURE__*/_jsxDEV(\"button\", {\n              className: \"action-btn next\",\n              onClick: handleExecute,\n              children: \"\\u4E0B\\u4E00\\u6B65\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 386,\n              columnNumber: 33\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 381,\n            columnNumber: 25\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 361,\n          columnNumber: 21\n        }, this);\n      } else if (c.type === 'SecondStep') {\n        if (c.dropzone) {\n          return /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"second-step\",\n            children: /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"dropzone\",\n              children: /*#__PURE__*/_jsxDEV(\"p\", {\n                children: c.text\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 395,\n                columnNumber: 55\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 395,\n              columnNumber: 29\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 394,\n            columnNumber: 25\n          }, this);\n        }\n        return /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"second-step\",\n          children: c.fileType === 'audio' ? /*#__PURE__*/_jsxDEV(AudioPlayer, {\n            file: c.file\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 402,\n            columnNumber: 29\n          }, this) : /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"video-player\",\n            children: /*#__PURE__*/_jsxDEV(\"video\", {\n              controls: true,\n              children: [/*#__PURE__*/_jsxDEV(\"source\", {\n                src: URL.createObjectURL(c.file),\n                type: c.file.type\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 406,\n                columnNumber: 37\n              }, this), \"Your browser does not support the video element.\"]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 405,\n              columnNumber: 33\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 404,\n            columnNumber: 29\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 400,\n          columnNumber: 21\n        }, this);\n      } else if (c.type === 'suggestion') {\n        return /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"suggestion-block\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"suggestion-title\",\n            children: c.title\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 416,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"suggestion-text\",\n            children: c.text\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 417,\n            columnNumber: 25\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 415,\n          columnNumber: 21\n        }, this);\n      }\n      return JSON.stringify(msg.content);\n    }\n    return msg.content;\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"App\",\n    children: /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"container\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"editor-section\",\n        children: /*#__PURE__*/_jsxDEV(ReactQuill, {\n          theme: \"snow\",\n          value: text,\n          onChange: setText,\n          modules: modules,\n          className: \"rich-text-editor\",\n          placeholder: \"Enter your text here...\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 430,\n          columnNumber: 21\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 429,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: `chat-section ${isDragging ? 'dragging' : ''}`,\n        onDragOver: e => {\n          e.preventDefault();\n          setIsDragging(true);\n        },\n        onDragLeave: () => setIsDragging(false),\n        onDrop: e => {\n          setIsDragging(false);\n          handleFileDrop(e);\n        },\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"chat-history\",\n          children: [chatHistory.map((msg, index) => /*#__PURE__*/_jsxDEV(\"div\", {\n            className: `chat-message ${msg.role}`,\n            children: /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"message-content\",\n              children: renderMessage(msg)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 449,\n              columnNumber: 33\n            }, this)\n          }, index, false, {\n            fileName: _jsxFileName,\n            lineNumber: 448,\n            columnNumber: 29\n          }, this)), isLoading && /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"loading\",\n            children: \"GPT is thinking...\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 452,\n            columnNumber: 39\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 446,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"form\", {\n          onSubmit: handleChatSubmit,\n          className: \"chat-input-form\",\n          children: [/*#__PURE__*/_jsxDEV(\"input\", {\n            type: \"text\",\n            value: chatInput,\n            onChange: e => setChatInput(e.target.value),\n            placeholder: \"Ask questions...\",\n            className: \"chat-input\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 455,\n            columnNumber: 25\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            type: \"submit\",\n            className: \"chat-submit\",\n            children: \"Send\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 462,\n            columnNumber: 25\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 454,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 440,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 428,\n      columnNumber: 13\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 427,\n    columnNumber: 9\n  }, this);\n}\n_s2(App, \"O2JPigibH6T8OrpW+z8Ubm13W68=\");\n_c2 = App;\nvar _c, _c2;\n$RefreshReg$(_c, \"AudioPlayer\");\n$RefreshReg$(_c2, \"App\");","map":{"version":3,"names":["useState","useRef","ReactQuill","jsxDEV","_jsxDEV","API_BASE","AudioPlayer","file","_s","duration","setDuration","currentTime","setCurrentTime","isPlaying","setIsPlaying","audioRef","formatTime","time","minutes","Math","floor","seconds","toString","padStart","handleLoadedMetadata","current","handleTimeUpdate","togglePlay","el","pause","play","p","handleDownload","url","URL","createObjectURL","a","document","createElement","href","download","name","body","appendChild","click","remove","revokeObjectURL","pct","className","children","fileName","_jsxFileName","lineNumber","columnNumber","type","value","onChange","e","next","Number","currentTarget","onClick","title","ref","onLoadedMetadata","onTimeUpdate","onEnded","src","_c","App","_s2","text","setText","chatInput","setChatInput","chatHistory","setChatHistory","isLoading","setIsLoading","steps","setSteps","id","description","draggedStep","setDraggedStep","isExecuted","setIsExecuted","isDragging","setIsDragging","hasGivenSuggestions","setHasGivenSuggestions","handleStepReorder","message","numbers","match","length","newOrder","map","num","parseInt","newSteps","index","handleChatSubmit","preventDefault","trim","prev","role","content","userInput","_data$choices","_data$choices$","_data$choices$$messag","_content$match","_content$match$","_content$match2","_content$match2$","_content$match3","_content$match3$","resp","fetch","method","headers","JSON","stringify","ok","Error","status","data","json","error","choices","story","metaphor","analogy","hasAny","err","toLowerCase","includes","test","response","_data$choices$0$messa","_data$choices2","_data$choices2$","_data$choices2$$messa","modules","toolbar","header","color","background","font","size","align","handleDragStart","step","classList","add","handleDragEnd","notifyLLMOfStepChange","handleDragOver","_index","stepBoxes","Array","from","querySelectorAll","afterElement","reduce","closest","child","box","getBoundingClientRect","offset","clientY","top","height","element","NEGATIVE_INFINITY","oldIndex","findIndex","s","newIndex","dataset","stepId","splice","_data$choices3","_data$choices3$","_data$choices3$$messa","i","position","handleModifySteps","handleExecute","dropzone","handleFileDrop","files","dataTransfer","media","filter","f","startsWith","forEach","fileType","renderMessage","msg","c","draggable","onDragStart","onDragEnd","onDragOver","controls","theme","placeholder","onDragLeave","onDrop","onSubmit","target","_c2","$RefreshReg$"],"sources":["/Users/primopan/WebstormProjects/luolan/WritingTutor/src/App.tsx"],"sourcesContent":["import { useState, useRef } from 'react';\nimport ReactQuill from 'react-quill';\nimport 'react-quill/dist/quill.snow.css';\nimport './App.css';\n\nconst API_BASE = 'http://10.30.9.1';\n\n/** ----------- 类型 ----------- */\ntype Role = 'user' | 'assistant' | 'error';\n\ninterface Step {\n    id: number;\n    name: string;\n    description: string;\n}\n\ninterface FirstStepContent {\n    type: 'FirstStep';\n    text: string;\n    steps: Step[];\n}\ninterface SecondStepDropzone {\n    type: 'SecondStep';\n    dropzone: true;\n    text: string;\n}\ninterface SecondStepFile {\n    type: 'SecondStep';\n    dropzone?: false;\n    fileType: 'audio' | 'video';\n    fileName: string;\n    file: File;\n}\ninterface SuggestionContent {\n    type: 'suggestion';\n    title: string;\n    text: string;\n}\n\ntype MessageContent =\n    | string\n    | FirstStepContent\n    | SecondStepDropzone\n    | SecondStepFile\n    | SuggestionContent;\n\ninterface ChatMessage {\n    role: Role;\n    content: MessageContent;\n}\n\n/** ----------- 组件 ----------- */\nfunction AudioPlayer({ file }: { file: File }) {\n    const [duration, setDuration] = useState('00:00');\n    const [currentTime, setCurrentTime] = useState('00:00');\n    const [isPlaying, setIsPlaying] = useState(false);\n    const audioRef = useRef<HTMLAudioElement | null>(null);\n\n    const formatTime = (time: number) => {\n        const minutes = Math.floor(time / 60);\n        const seconds = Math.floor(time % 60);\n        return `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;\n    };\n\n    const handleLoadedMetadata = () => {\n        if (audioRef.current) setDuration(formatTime(audioRef.current.duration));\n    };\n\n    const handleTimeUpdate = () => {\n        if (audioRef.current) setCurrentTime(formatTime(audioRef.current.currentTime));\n    };\n\n    const togglePlay = () => {\n        const el = audioRef.current;\n        if (!el) return;\n        if (isPlaying) el.pause();\n        else el.play();\n        setIsPlaying(p => !p);\n    };\n\n    const handleDownload = () => {\n        const url = URL.createObjectURL(file);\n        const a = document.createElement('a');\n        a.href = url;\n        a.download = file.name;\n        document.body.appendChild(a);\n        a.click();\n        a.remove();\n        URL.revokeObjectURL(url);\n    };\n\n    const pct =\n        audioRef.current && audioRef.current.duration\n            ? (audioRef.current.currentTime / audioRef.current.duration) * 100\n            : 0;\n\n    return (\n        <div className=\"audio-player\">\n            <div className=\"audio-progress\">\n                <div className=\"time-info\">\n                    <span className=\"current-time\">{currentTime}</span>\n                    <span className=\"duration\">{duration}</span>\n                </div>\n                <div className=\"progress-bar-container\">\n                    <input\n                        type=\"range\"\n                        className=\"progress-bar\"\n                        value={pct}\n                        onChange={(e) => {\n                            const el = audioRef.current;\n                            if (!el) return;\n                            const next = (Number(e.currentTarget.value) / 100) * el.duration;\n                            el.currentTime = next;\n                        }}\n                    />\n                    <div className=\"audio-controls\">\n                        <button\n                            className={`control-btn ${isPlaying ? 'pause' : 'play'}`}\n                            onClick={togglePlay}\n                            title={isPlaying ? '暂停' : '播放'}\n                        >\n                            {isPlaying ? '⏸' : '▶'}\n                        </button>\n                        <button className=\"control-btn download\" onClick={handleDownload} title=\"下载\">\n                            ⬇\n                        </button>\n                    </div>\n                </div>\n            </div>\n            <audio\n                ref={audioRef}\n                onLoadedMetadata={handleLoadedMetadata}\n                onTimeUpdate={handleTimeUpdate}\n                onEnded={() => setIsPlaying(false)}\n            >\n                <source src={URL.createObjectURL(file)} type={file.type} />\n                Your browser does not support the audio element.\n            </audio>\n        </div>\n    );\n}\n\n/** ----------- 页面 ----------- */\nexport default function App() {\n    const [text, setText] = useState<string>('');\n    const [chatInput, setChatInput] = useState<string>('');\n    const [chatHistory, setChatHistory] = useState<ChatMessage[]>([]);\n    const [isLoading, setIsLoading] = useState<boolean>(false);\n    const [steps, setSteps] = useState<Step[]>([\n        { id: 1, name: 'Hook', description: '吸引听众注意力的开场白' },\n        { id: 2, name: 'Exploration', description: '探索和解释研究内容' },\n        { id: 3, name: 'Resolution', description: '总结研究的影响和意义' }\n    ]);\n    const [draggedStep, setDraggedStep] = useState<Step | null>(null);\n    const [isExecuted, setIsExecuted] = useState<boolean>(false);\n    const [isDragging, setIsDragging] = useState<boolean>(false);\n    const [hasGivenSuggestions, setHasGivenSuggestions] = useState<boolean>(false);\n\n    const handleStepReorder = (message: string) => {\n        const numbers = message.match(/\\d+/g);\n        if (numbers && numbers.length === 3) {\n            const newOrder = numbers.map(num => parseInt(num, 10) - 1);\n            const newSteps = newOrder.map(index => steps[index]);\n            setSteps(newSteps);\n            return `步骤已调整为：\\n\\n1. ${newSteps[0].name}: ${newSteps[0].description}\\n2. ${newSteps[1].name}: ${newSteps[1].description}\\n3. ${newSteps[2].name}: ${newSteps[2].description}`;\n        }\n        return '请按照格式输入要调整的步骤顺序，例如：\"1 3 2\" 表示将第二步和第三步互换位置。';\n    };\n\n    const handleChatSubmit = async (e: React.FormEvent<HTMLFormElement>) => {\n        e.preventDefault();\n        if (!chatInput.trim()) return;\n\n        setChatHistory(prev => [...prev, { role: 'user', content: chatInput }]);\n        const userInput = chatInput;\n        setChatInput('');\n\n        // 只在第一次输入后给出建议\n        if (!hasGivenSuggestions) {\n            setIsLoading(true);\n            try {\n                const resp = await fetch(`${API_BASE}/api/convert`, {\n                    method: 'POST',\n                    headers: { 'Content-Type': 'application/json' },\n                    body: JSON.stringify({\n                        text: `请根据以下research内容，分别用如下格式严格给出三类建议，每条建议一行：\\nStorytelling: （一句建议）\\nMetaphor: （一句建议）\\nAnalogy: （一句建议）\\n内容：${userInput}\\n请严格按照上述格式输出。`\n                    })\n                });\n                if (!resp.ok) throw new Error(`HTTP ${resp.status}`);\n                const data = await resp.json();\n                if (data.error) throw new Error(data.error);\n                const content: string = data.choices?.[0]?.message?.content || '';\n\n                const story = content.match(/Storytelling[:：](.*)/i)?.[1]?.trim();\n                const metaphor = content.match(/Metaphor[:：](.*)/i)?.[1]?.trim();\n                const analogy = content.match(/Analogy[:：](.*)/i)?.[1]?.trim();\n\n                let hasAny = false;\n                if (story) {\n                    setChatHistory(prev => [...prev, { role: 'assistant', content: { type: 'suggestion', title: 'Storytelling 建议', text: story } }]);\n                    hasAny = true;\n                }\n                if (metaphor) {\n                    setChatHistory(prev => [...prev, { role: 'assistant', content: { type: 'suggestion', title: 'Metaphor 隐喻建议', text: metaphor } }]);\n                    hasAny = true;\n                }\n                if (analogy) {\n                    setChatHistory(prev => [...prev, { role: 'assistant', content: { type: 'suggestion', title: 'Analogy 类比建议', text: analogy } }]);\n                    hasAny = true;\n                }\n                if (!hasAny) {\n                    setChatHistory(prev => [...prev, { role: 'assistant', content }]);\n                }\n                setHasGivenSuggestions(true);\n            } catch (err: any) {\n                setChatHistory(prev => [...prev, { role: 'error', content: `Error: ${err.message}` }]);\n            } finally {\n                setIsLoading(false);\n            }\n            return;\n        }\n\n        // 处理步骤调整的请求\n        if (userInput.toLowerCase().includes('调整步骤')) {\n            setChatHistory(prev => [...prev, { role: 'assistant', content: '请输入想要的步骤顺序（例如：1 3 2）：' }]);\n            return;\n        }\n\n        // 检查是否是步骤顺序输入\n        if (/^\\d+\\s+\\d+\\s+\\d+$/.test(userInput)) {\n            const response = handleStepReorder(userInput);\n            setChatHistory(prev => [...prev, { role: 'assistant', content: response }]);\n            return;\n        }\n\n        // 处理其他对话\n        setIsLoading(true);\n        try {\n            const resp = await fetch(`${API_BASE}/api/convert`, {\n                method: 'POST',\n                headers: { 'Content-Type': 'application/json' },\n                body: JSON.stringify({ text: userInput })\n            });\n            if (!resp.ok) throw new Error(`HTTP ${resp.status}`);\n            const data = await resp.json();\n            if (data.error) throw new Error(data.error);\n            const content: string = data.choices?.[0]?.message?.content ?? '(no content)';\n            setChatHistory(prev => [...prev, { role: 'assistant', content }]);\n        } catch (err: any) {\n            setChatHistory(prev => [...prev, { role: 'error', content: `Error: ${err.message}` }]);\n        } finally {\n            setIsLoading(false);\n        }\n    };\n\n    const modules: any = {\n        toolbar: [\n            [{ header: [1, 2, 3, false] }],\n            ['bold', 'italic', 'underline', 'strike'],\n            [{ color: [] }, { background: [] }],\n            [{ font: [] }],\n            [{ size: ['small', false, 'large', 'huge'] }],\n            [{ align: [] }],\n            ['clean']\n        ],\n    };\n\n    const handleDragStart = (e: React.DragEvent<HTMLDivElement>, step: Step) => {\n        setDraggedStep(step);\n        e.currentTarget.classList.add('dragging');\n    };\n\n    const handleDragEnd = (e: React.DragEvent<HTMLDivElement>) => {\n        e.currentTarget.classList.remove('dragging');\n        notifyLLMOfStepChange(steps);\n    };\n\n    const handleDragOver = (e: React.DragEvent<HTMLDivElement>, _index: number) => {\n        e.preventDefault();\n        const stepBoxes = Array.from(document.querySelectorAll<HTMLDivElement>('.step-content-box'));\n        const afterElement = stepBoxes.reduce<{ offset: number; element?: HTMLDivElement }>((closest, child) => {\n            const box = child.getBoundingClientRect();\n            const offset = e.clientY - box.top - box.height / 2;\n            if (offset < 0 && offset > closest.offset) return { offset, element: child };\n            return closest;\n        }, { offset: Number.NEGATIVE_INFINITY }).element;\n\n        if (afterElement && draggedStep) {\n            const newSteps = [...steps];\n            const oldIndex = steps.findIndex(s => s.id === draggedStep.id);\n            const newIndex = steps.findIndex(s => s.id === Number(afterElement.dataset.stepId));\n            newSteps.splice(oldIndex, 1);\n            newSteps.splice(newIndex, 0, draggedStep);\n            setSteps(newSteps);\n        }\n    };\n\n    const notifyLLMOfStepChange = async (newSteps: Step[]) => {\n        setIsLoading(true);\n        try {\n            const resp = await fetch(`${API_BASE}/api/convert`, {\n                method: 'POST',\n                headers: { 'Content-Type': 'application/json' },\n                body: JSON.stringify({\n                    text: 'steps_reordered',\n                    steps: newSteps.map((s, i) => ({\n                        position: i + 1,\n                        name: s.name,\n                        description: s.description\n                    }))\n                })\n            });\n            if (!resp.ok) throw new Error(`HTTP ${resp.status}`);\n            const data = await resp.json();\n            if (data.error) throw new Error(data.error);\n            const content: string | undefined = data.choices?.[0]?.message?.content;\n            if (content) {\n                setChatHistory(prev => [...prev, { role: 'assistant', content }]);\n            }\n        } catch (err: any) {\n            setChatHistory(prev => [...prev, { role: 'error', content: `Error updating step order: ${err.message}` }]);\n        } finally {\n            setIsLoading(false);\n        }\n    };\n\n    const handleModifySteps = () => {\n        setChatHistory(prev => [...prev, { role: 'assistant', content: '请拖拽调整步骤顺序。' }]);\n    };\n\n    const handleExecute = () => {\n        setIsExecuted(true);\n        setChatHistory(prev => [...prev, {\n            role: 'assistant',\n            content: { type: 'SecondStep', dropzone: true, text: '请将音频或视频文件拖拽到这里' }\n        }]);\n    };\n\n    const handleFileDrop = (e: React.DragEvent<HTMLDivElement>) => {\n        e.preventDefault();\n        const files = Array.from(e.dataTransfer.files);\n        const media = files.filter(f => f.type.startsWith('audio/') || f.type.startsWith('video/'));\n        media.forEach(file => {\n            setChatHistory(prev => [...prev, {\n                role: 'assistant',\n                content: {\n                    type: 'SecondStep',\n                    fileType: file.type.startsWith('audio/') ? 'audio' : 'video',\n                    fileName: file.name,\n                    file\n                } as SecondStepFile\n            }]);\n        });\n    };\n\n    const renderMessage = (msg: ChatMessage) => {\n        if (typeof msg.content === 'object') {\n            const c: any = msg.content;\n            if (c.type === 'FirstStep') {\n                return (\n                    <div className=\"first-step\">\n                        <div className=\"message-text\">{c.text}</div>\n                        <div className=\"steps-container\">\n                            {c.steps.map((step: Step, index: number) => (\n                                <div className=\"step-box\" key={step.id}>\n                                    <div className=\"step-number\">Step {index + 1}</div>\n                                    <div\n                                        className=\"step-content-box\"\n                                        draggable\n                                        data-step-id={step.id}\n                                        onDragStart={(e) => handleDragStart(e, step)}\n                                        onDragEnd={handleDragEnd}\n                                        onDragOver={(e) => handleDragOver(e, index)}\n                                    >\n                                        <div className=\"step-name\">{step.name}</div>\n                                        <div className=\"step-description\">{step.description}</div>\n                                    </div>\n                                </div>\n                            ))}\n                        </div>\n                        <div className=\"action-buttons\">\n                            <button className=\"action-btn modify\" onClick={handleModifySteps}>修改</button>\n                            {!isExecuted ? (\n                                <button className=\"action-btn execute\" onClick={handleExecute}>执行</button>\n                            ) : (\n                                <button className=\"action-btn next\" onClick={handleExecute}>下一步</button>\n                            )}\n                        </div>\n                    </div>\n                );\n            } else if (c.type === 'SecondStep') {\n                if (c.dropzone) {\n                    return (\n                        <div className=\"second-step\">\n                            <div className=\"dropzone\"><p>{c.text}</p></div>\n                        </div>\n                    );\n                }\n                return (\n                    <div className=\"second-step\">\n                        {c.fileType === 'audio' ? (\n                            <AudioPlayer file={c.file} />\n                        ) : (\n                            <div className=\"video-player\">\n                                <video controls>\n                                    <source src={URL.createObjectURL(c.file)} type={c.file.type} />\n                                    Your browser does not support the video element.\n                                </video>\n                            </div>\n                        )}\n                    </div>\n                );\n            } else if (c.type === 'suggestion') {\n                return (\n                    <div className=\"suggestion-block\">\n                        <div className=\"suggestion-title\">{c.title}</div>\n                        <div className=\"suggestion-text\">{c.text}</div>\n                    </div>\n                );\n            }\n            return JSON.stringify(msg.content);\n        }\n        return msg.content;\n    };\n\n    return (\n        <div className=\"App\">\n            <div className=\"container\">\n                <div className=\"editor-section\">\n                    <ReactQuill\n                        theme=\"snow\"\n                        value={text}\n                        onChange={setText}\n                        modules={modules}\n                        className=\"rich-text-editor\"\n                        placeholder=\"Enter your text here...\"\n                    />\n                </div>\n\n                <div\n                    className={`chat-section ${isDragging ? 'dragging' : ''}`}\n                    onDragOver={(e) => { e.preventDefault(); setIsDragging(true); }}\n                    onDragLeave={() => setIsDragging(false)}\n                    onDrop={(e) => { setIsDragging(false); handleFileDrop(e); }}\n                >\n                    <div className=\"chat-history\">\n                        {chatHistory.map((msg, index) => (\n                            <div key={index} className={`chat-message ${msg.role}`}>\n                                <div className=\"message-content\">{renderMessage(msg)}</div>\n                            </div>\n                        ))}\n                        {isLoading && <div className=\"loading\">GPT is thinking...</div>}\n                    </div>\n                    <form onSubmit={handleChatSubmit} className=\"chat-input-form\">\n                        <input\n                            type=\"text\"\n                            value={chatInput}\n                            onChange={(e) => setChatInput(e.target.value)}\n                            placeholder=\"Ask questions...\"\n                            className=\"chat-input\"\n                        />\n                        <button type=\"submit\" className=\"chat-submit\">Send</button>\n                    </form>\n                </div>\n            </div>\n        </div>\n    );\n}\n"],"mappings":";;;AAAA,SAASA,QAAQ,EAAEC,MAAM,QAAQ,OAAO;AACxC,OAAOC,UAAU,MAAM,aAAa;AACpC,OAAO,iCAAiC;AACxC,OAAO,WAAW;AAAC,SAAAC,MAAA,IAAAC,OAAA;AAEnB,MAAMC,QAAQ,GAAG,kBAAkB;;AAEnC;;AA4CA;AACA,SAASC,WAAWA,CAAC;EAAEC;AAAqB,CAAC,EAAE;EAAAC,EAAA;EAC3C,MAAM,CAACC,QAAQ,EAAEC,WAAW,CAAC,GAAGV,QAAQ,CAAC,OAAO,CAAC;EACjD,MAAM,CAACW,WAAW,EAAEC,cAAc,CAAC,GAAGZ,QAAQ,CAAC,OAAO,CAAC;EACvD,MAAM,CAACa,SAAS,EAAEC,YAAY,CAAC,GAAGd,QAAQ,CAAC,KAAK,CAAC;EACjD,MAAMe,QAAQ,GAAGd,MAAM,CAA0B,IAAI,CAAC;EAEtD,MAAMe,UAAU,GAAIC,IAAY,IAAK;IACjC,MAAMC,OAAO,GAAGC,IAAI,CAACC,KAAK,CAACH,IAAI,GAAG,EAAE,CAAC;IACrC,MAAMI,OAAO,GAAGF,IAAI,CAACC,KAAK,CAACH,IAAI,GAAG,EAAE,CAAC;IACrC,OAAO,GAAGC,OAAO,CAACI,QAAQ,CAAC,CAAC,CAACC,QAAQ,CAAC,CAAC,EAAE,GAAG,CAAC,IAAIF,OAAO,CAACC,QAAQ,CAAC,CAAC,CAACC,QAAQ,CAAC,CAAC,EAAE,GAAG,CAAC,EAAE;EAC1F,CAAC;EAED,MAAMC,oBAAoB,GAAGA,CAAA,KAAM;IAC/B,IAAIT,QAAQ,CAACU,OAAO,EAAEf,WAAW,CAACM,UAAU,CAACD,QAAQ,CAACU,OAAO,CAAChB,QAAQ,CAAC,CAAC;EAC5E,CAAC;EAED,MAAMiB,gBAAgB,GAAGA,CAAA,KAAM;IAC3B,IAAIX,QAAQ,CAACU,OAAO,EAAEb,cAAc,CAACI,UAAU,CAACD,QAAQ,CAACU,OAAO,CAACd,WAAW,CAAC,CAAC;EAClF,CAAC;EAED,MAAMgB,UAAU,GAAGA,CAAA,KAAM;IACrB,MAAMC,EAAE,GAAGb,QAAQ,CAACU,OAAO;IAC3B,IAAI,CAACG,EAAE,EAAE;IACT,IAAIf,SAAS,EAAEe,EAAE,CAACC,KAAK,CAAC,CAAC,CAAC,KACrBD,EAAE,CAACE,IAAI,CAAC,CAAC;IACdhB,YAAY,CAACiB,CAAC,IAAI,CAACA,CAAC,CAAC;EACzB,CAAC;EAED,MAAMC,cAAc,GAAGA,CAAA,KAAM;IACzB,MAAMC,GAAG,GAAGC,GAAG,CAACC,eAAe,CAAC5B,IAAI,CAAC;IACrC,MAAM6B,CAAC,GAAGC,QAAQ,CAACC,aAAa,CAAC,GAAG,CAAC;IACrCF,CAAC,CAACG,IAAI,GAAGN,GAAG;IACZG,CAAC,CAACI,QAAQ,GAAGjC,IAAI,CAACkC,IAAI;IACtBJ,QAAQ,CAACK,IAAI,CAACC,WAAW,CAACP,CAAC,CAAC;IAC5BA,CAAC,CAACQ,KAAK,CAAC,CAAC;IACTR,CAAC,CAACS,MAAM,CAAC,CAAC;IACVX,GAAG,CAACY,eAAe,CAACb,GAAG,CAAC;EAC5B,CAAC;EAED,MAAMc,GAAG,GACLhC,QAAQ,CAACU,OAAO,IAAIV,QAAQ,CAACU,OAAO,CAAChB,QAAQ,GACtCM,QAAQ,CAACU,OAAO,CAACd,WAAW,GAAGI,QAAQ,CAACU,OAAO,CAAChB,QAAQ,GAAI,GAAG,GAChE,CAAC;EAEX,oBACIL,OAAA;IAAK4C,SAAS,EAAC,cAAc;IAAAC,QAAA,gBACzB7C,OAAA;MAAK4C,SAAS,EAAC,gBAAgB;MAAAC,QAAA,gBAC3B7C,OAAA;QAAK4C,SAAS,EAAC,WAAW;QAAAC,QAAA,gBACtB7C,OAAA;UAAM4C,SAAS,EAAC,cAAc;UAAAC,QAAA,EAAEtC;QAAW;UAAAuC,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAAO,CAAC,eACnDjD,OAAA;UAAM4C,SAAS,EAAC,UAAU;UAAAC,QAAA,EAAExC;QAAQ;UAAAyC,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAAO,CAAC;MAAA;QAAAH,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OAC3C,CAAC,eACNjD,OAAA;QAAK4C,SAAS,EAAC,wBAAwB;QAAAC,QAAA,gBACnC7C,OAAA;UACIkD,IAAI,EAAC,OAAO;UACZN,SAAS,EAAC,cAAc;UACxBO,KAAK,EAAER,GAAI;UACXS,QAAQ,EAAGC,CAAC,IAAK;YACb,MAAM7B,EAAE,GAAGb,QAAQ,CAACU,OAAO;YAC3B,IAAI,CAACG,EAAE,EAAE;YACT,MAAM8B,IAAI,GAAIC,MAAM,CAACF,CAAC,CAACG,aAAa,CAACL,KAAK,CAAC,GAAG,GAAG,GAAI3B,EAAE,CAACnB,QAAQ;YAChEmB,EAAE,CAACjB,WAAW,GAAG+C,IAAI;UACzB;QAAE;UAAAR,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OACL,CAAC,eACFjD,OAAA;UAAK4C,SAAS,EAAC,gBAAgB;UAAAC,QAAA,gBAC3B7C,OAAA;YACI4C,SAAS,EAAE,eAAenC,SAAS,GAAG,OAAO,GAAG,MAAM,EAAG;YACzDgD,OAAO,EAAElC,UAAW;YACpBmC,KAAK,EAAEjD,SAAS,GAAG,IAAI,GAAG,IAAK;YAAAoC,QAAA,EAE9BpC,SAAS,GAAG,GAAG,GAAG;UAAG;YAAAqC,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAClB,CAAC,eACTjD,OAAA;YAAQ4C,SAAS,EAAC,sBAAsB;YAACa,OAAO,EAAE7B,cAAe;YAAC8B,KAAK,EAAC,cAAI;YAAAb,QAAA,EAAC;UAE7E;YAAAC,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAAQ,CAAC;QAAA;UAAAH,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OACR,CAAC;MAAA;QAAAH,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OACL,CAAC;IAAA;MAAAH,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OACL,CAAC,eACNjD,OAAA;MACI2D,GAAG,EAAEhD,QAAS;MACdiD,gBAAgB,EAAExC,oBAAqB;MACvCyC,YAAY,EAAEvC,gBAAiB;MAC/BwC,OAAO,EAAEA,CAAA,KAAMpD,YAAY,CAAC,KAAK,CAAE;MAAAmC,QAAA,gBAEnC7C,OAAA;QAAQ+D,GAAG,EAAEjC,GAAG,CAACC,eAAe,CAAC5B,IAAI,CAAE;QAAC+C,IAAI,EAAE/C,IAAI,CAAC+C;MAAK;QAAAJ,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OAAE,CAAC,oDAE/D;IAAA;MAAAH,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OAAO,CAAC;EAAA;IAAAH,QAAA,EAAAC,YAAA;IAAAC,UAAA;IAAAC,YAAA;EAAA,OACP,CAAC;AAEd;;AAEA;AAAA7C,EAAA,CA1FSF,WAAW;AAAA8D,EAAA,GAAX9D,WAAW;AA2FpB,eAAe,SAAS+D,GAAGA,CAAA,EAAG;EAAAC,GAAA;EAC1B,MAAM,CAACC,IAAI,EAAEC,OAAO,CAAC,GAAGxE,QAAQ,CAAS,EAAE,CAAC;EAC5C,MAAM,CAACyE,SAAS,EAAEC,YAAY,CAAC,GAAG1E,QAAQ,CAAS,EAAE,CAAC;EACtD,MAAM,CAAC2E,WAAW,EAAEC,cAAc,CAAC,GAAG5E,QAAQ,CAAgB,EAAE,CAAC;EACjE,MAAM,CAAC6E,SAAS,EAAEC,YAAY,CAAC,GAAG9E,QAAQ,CAAU,KAAK,CAAC;EAC1D,MAAM,CAAC+E,KAAK,EAAEC,QAAQ,CAAC,GAAGhF,QAAQ,CAAS,CACvC;IAAEiF,EAAE,EAAE,CAAC;IAAExC,IAAI,EAAE,MAAM;IAAEyC,WAAW,EAAE;EAAc,CAAC,EACnD;IAAED,EAAE,EAAE,CAAC;IAAExC,IAAI,EAAE,aAAa;IAAEyC,WAAW,EAAE;EAAY,CAAC,EACxD;IAAED,EAAE,EAAE,CAAC;IAAExC,IAAI,EAAE,YAAY;IAAEyC,WAAW,EAAE;EAAa,CAAC,CAC3D,CAAC;EACF,MAAM,CAACC,WAAW,EAAEC,cAAc,CAAC,GAAGpF,QAAQ,CAAc,IAAI,CAAC;EACjE,MAAM,CAACqF,UAAU,EAAEC,aAAa,CAAC,GAAGtF,QAAQ,CAAU,KAAK,CAAC;EAC5D,MAAM,CAACuF,UAAU,EAAEC,aAAa,CAAC,GAAGxF,QAAQ,CAAU,KAAK,CAAC;EAC5D,MAAM,CAACyF,mBAAmB,EAAEC,sBAAsB,CAAC,GAAG1F,QAAQ,CAAU,KAAK,CAAC;EAE9E,MAAM2F,iBAAiB,GAAIC,OAAe,IAAK;IAC3C,MAAMC,OAAO,GAAGD,OAAO,CAACE,KAAK,CAAC,MAAM,CAAC;IACrC,IAAID,OAAO,IAAIA,OAAO,CAACE,MAAM,KAAK,CAAC,EAAE;MACjC,MAAMC,QAAQ,GAAGH,OAAO,CAACI,GAAG,CAACC,GAAG,IAAIC,QAAQ,CAACD,GAAG,EAAE,EAAE,CAAC,GAAG,CAAC,CAAC;MAC1D,MAAME,QAAQ,GAAGJ,QAAQ,CAACC,GAAG,CAACI,KAAK,IAAItB,KAAK,CAACsB,KAAK,CAAC,CAAC;MACpDrB,QAAQ,CAACoB,QAAQ,CAAC;MAClB,OAAO,iBAAiBA,QAAQ,CAAC,CAAC,CAAC,CAAC3D,IAAI,KAAK2D,QAAQ,CAAC,CAAC,CAAC,CAAClB,WAAW,QAAQkB,QAAQ,CAAC,CAAC,CAAC,CAAC3D,IAAI,KAAK2D,QAAQ,CAAC,CAAC,CAAC,CAAClB,WAAW,QAAQkB,QAAQ,CAAC,CAAC,CAAC,CAAC3D,IAAI,KAAK2D,QAAQ,CAAC,CAAC,CAAC,CAAClB,WAAW,EAAE;IAClL;IACA,OAAO,4CAA4C;EACvD,CAAC;EAED,MAAMoB,gBAAgB,GAAG,MAAO7C,CAAmC,IAAK;IACpEA,CAAC,CAAC8C,cAAc,CAAC,CAAC;IAClB,IAAI,CAAC9B,SAAS,CAAC+B,IAAI,CAAC,CAAC,EAAE;IAEvB5B,cAAc,CAAC6B,IAAI,IAAI,CAAC,GAAGA,IAAI,EAAE;MAAEC,IAAI,EAAE,MAAM;MAAEC,OAAO,EAAElC;IAAU,CAAC,CAAC,CAAC;IACvE,MAAMmC,SAAS,GAAGnC,SAAS;IAC3BC,YAAY,CAAC,EAAE,CAAC;;IAEhB;IACA,IAAI,CAACe,mBAAmB,EAAE;MACtBX,YAAY,CAAC,IAAI,CAAC;MAClB,IAAI;QAAA,IAAA+B,aAAA,EAAAC,cAAA,EAAAC,qBAAA,EAAAC,cAAA,EAAAC,eAAA,EAAAC,eAAA,EAAAC,gBAAA,EAAAC,eAAA,EAAAC,gBAAA;QACA,MAAMC,IAAI,GAAG,MAAMC,KAAK,CAAC,GAAGlH,QAAQ,cAAc,EAAE;UAChDmH,MAAM,EAAE,MAAM;UACdC,OAAO,EAAE;YAAE,cAAc,EAAE;UAAmB,CAAC;UAC/C/E,IAAI,EAAEgF,IAAI,CAACC,SAAS,CAAC;YACjBpD,IAAI,EAAE,wGAAwGqC,SAAS;UAC3H,CAAC;QACL,CAAC,CAAC;QACF,IAAI,CAACU,IAAI,CAACM,EAAE,EAAE,MAAM,IAAIC,KAAK,CAAC,QAAQP,IAAI,CAACQ,MAAM,EAAE,CAAC;QACpD,MAAMC,IAAI,GAAG,MAAMT,IAAI,CAACU,IAAI,CAAC,CAAC;QAC9B,IAAID,IAAI,CAACE,KAAK,EAAE,MAAM,IAAIJ,KAAK,CAACE,IAAI,CAACE,KAAK,CAAC;QAC3C,MAAMtB,OAAe,GAAG,EAAAE,aAAA,GAAAkB,IAAI,CAACG,OAAO,cAAArB,aAAA,wBAAAC,cAAA,GAAZD,aAAA,CAAe,CAAC,CAAC,cAAAC,cAAA,wBAAAC,qBAAA,GAAjBD,cAAA,CAAmBlB,OAAO,cAAAmB,qBAAA,uBAA1BA,qBAAA,CAA4BJ,OAAO,KAAI,EAAE;QAEjE,MAAMwB,KAAK,IAAAnB,cAAA,GAAGL,OAAO,CAACb,KAAK,CAAC,uBAAuB,CAAC,cAAAkB,cAAA,wBAAAC,eAAA,GAAtCD,cAAA,CAAyC,CAAC,CAAC,cAAAC,eAAA,uBAA3CA,eAAA,CAA6CT,IAAI,CAAC,CAAC;QACjE,MAAM4B,QAAQ,IAAAlB,eAAA,GAAGP,OAAO,CAACb,KAAK,CAAC,mBAAmB,CAAC,cAAAoB,eAAA,wBAAAC,gBAAA,GAAlCD,eAAA,CAAqC,CAAC,CAAC,cAAAC,gBAAA,uBAAvCA,gBAAA,CAAyCX,IAAI,CAAC,CAAC;QAChE,MAAM6B,OAAO,IAAAjB,eAAA,GAAGT,OAAO,CAACb,KAAK,CAAC,kBAAkB,CAAC,cAAAsB,eAAA,wBAAAC,gBAAA,GAAjCD,eAAA,CAAoC,CAAC,CAAC,cAAAC,gBAAA,uBAAtCA,gBAAA,CAAwCb,IAAI,CAAC,CAAC;QAE9D,IAAI8B,MAAM,GAAG,KAAK;QAClB,IAAIH,KAAK,EAAE;UACPvD,cAAc,CAAC6B,IAAI,IAAI,CAAC,GAAGA,IAAI,EAAE;YAAEC,IAAI,EAAE,WAAW;YAAEC,OAAO,EAAE;cAAErD,IAAI,EAAE,YAAY;cAAEQ,KAAK,EAAE,iBAAiB;cAAES,IAAI,EAAE4D;YAAM;UAAE,CAAC,CAAC,CAAC;UAChIG,MAAM,GAAG,IAAI;QACjB;QACA,IAAIF,QAAQ,EAAE;UACVxD,cAAc,CAAC6B,IAAI,IAAI,CAAC,GAAGA,IAAI,EAAE;YAAEC,IAAI,EAAE,WAAW;YAAEC,OAAO,EAAE;cAAErD,IAAI,EAAE,YAAY;cAAEQ,KAAK,EAAE,eAAe;cAAES,IAAI,EAAE6D;YAAS;UAAE,CAAC,CAAC,CAAC;UACjIE,MAAM,GAAG,IAAI;QACjB;QACA,IAAID,OAAO,EAAE;UACTzD,cAAc,CAAC6B,IAAI,IAAI,CAAC,GAAGA,IAAI,EAAE;YAAEC,IAAI,EAAE,WAAW;YAAEC,OAAO,EAAE;cAAErD,IAAI,EAAE,YAAY;cAAEQ,KAAK,EAAE,cAAc;cAAES,IAAI,EAAE8D;YAAQ;UAAE,CAAC,CAAC,CAAC;UAC/HC,MAAM,GAAG,IAAI;QACjB;QACA,IAAI,CAACA,MAAM,EAAE;UACT1D,cAAc,CAAC6B,IAAI,IAAI,CAAC,GAAGA,IAAI,EAAE;YAAEC,IAAI,EAAE,WAAW;YAAEC;UAAQ,CAAC,CAAC,CAAC;QACrE;QACAjB,sBAAsB,CAAC,IAAI,CAAC;MAChC,CAAC,CAAC,OAAO6C,GAAQ,EAAE;QACf3D,cAAc,CAAC6B,IAAI,IAAI,CAAC,GAAGA,IAAI,EAAE;UAAEC,IAAI,EAAE,OAAO;UAAEC,OAAO,EAAE,UAAU4B,GAAG,CAAC3C,OAAO;QAAG,CAAC,CAAC,CAAC;MAC1F,CAAC,SAAS;QACNd,YAAY,CAAC,KAAK,CAAC;MACvB;MACA;IACJ;;IAEA;IACA,IAAI8B,SAAS,CAAC4B,WAAW,CAAC,CAAC,CAACC,QAAQ,CAAC,MAAM,CAAC,EAAE;MAC1C7D,cAAc,CAAC6B,IAAI,IAAI,CAAC,GAAGA,IAAI,EAAE;QAAEC,IAAI,EAAE,WAAW;QAAEC,OAAO,EAAE;MAAwB,CAAC,CAAC,CAAC;MAC1F;IACJ;;IAEA;IACA,IAAI,mBAAmB,CAAC+B,IAAI,CAAC9B,SAAS,CAAC,EAAE;MACrC,MAAM+B,QAAQ,GAAGhD,iBAAiB,CAACiB,SAAS,CAAC;MAC7ChC,cAAc,CAAC6B,IAAI,IAAI,CAAC,GAAGA,IAAI,EAAE;QAAEC,IAAI,EAAE,WAAW;QAAEC,OAAO,EAAEgC;MAAS,CAAC,CAAC,CAAC;MAC3E;IACJ;;IAEA;IACA7D,YAAY,CAAC,IAAI,CAAC;IAClB,IAAI;MAAA,IAAA8D,qBAAA,EAAAC,cAAA,EAAAC,eAAA,EAAAC,qBAAA;MACA,MAAMzB,IAAI,GAAG,MAAMC,KAAK,CAAC,GAAGlH,QAAQ,cAAc,EAAE;QAChDmH,MAAM,EAAE,MAAM;QACdC,OAAO,EAAE;UAAE,cAAc,EAAE;QAAmB,CAAC;QAC/C/E,IAAI,EAAEgF,IAAI,CAACC,SAAS,CAAC;UAAEpD,IAAI,EAAEqC;QAAU,CAAC;MAC5C,CAAC,CAAC;MACF,IAAI,CAACU,IAAI,CAACM,EAAE,EAAE,MAAM,IAAIC,KAAK,CAAC,QAAQP,IAAI,CAACQ,MAAM,EAAE,CAAC;MACpD,MAAMC,IAAI,GAAG,MAAMT,IAAI,CAACU,IAAI,CAAC,CAAC;MAC9B,IAAID,IAAI,CAACE,KAAK,EAAE,MAAM,IAAIJ,KAAK,CAACE,IAAI,CAACE,KAAK,CAAC;MAC3C,MAAMtB,OAAe,IAAAiC,qBAAA,IAAAC,cAAA,GAAGd,IAAI,CAACG,OAAO,cAAAW,cAAA,wBAAAC,eAAA,GAAZD,cAAA,CAAe,CAAC,CAAC,cAAAC,eAAA,wBAAAC,qBAAA,GAAjBD,eAAA,CAAmBlD,OAAO,cAAAmD,qBAAA,uBAA1BA,qBAAA,CAA4BpC,OAAO,cAAAiC,qBAAA,cAAAA,qBAAA,GAAI,cAAc;MAC7EhE,cAAc,CAAC6B,IAAI,IAAI,CAAC,GAAGA,IAAI,EAAE;QAAEC,IAAI,EAAE,WAAW;QAAEC;MAAQ,CAAC,CAAC,CAAC;IACrE,CAAC,CAAC,OAAO4B,GAAQ,EAAE;MACf3D,cAAc,CAAC6B,IAAI,IAAI,CAAC,GAAGA,IAAI,EAAE;QAAEC,IAAI,EAAE,OAAO;QAAEC,OAAO,EAAE,UAAU4B,GAAG,CAAC3C,OAAO;MAAG,CAAC,CAAC,CAAC;IAC1F,CAAC,SAAS;MACNd,YAAY,CAAC,KAAK,CAAC;IACvB;EACJ,CAAC;EAED,MAAMkE,OAAY,GAAG;IACjBC,OAAO,EAAE,CACL,CAAC;MAAEC,MAAM,EAAE,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,KAAK;IAAE,CAAC,CAAC,EAC9B,CAAC,MAAM,EAAE,QAAQ,EAAE,WAAW,EAAE,QAAQ,CAAC,EACzC,CAAC;MAAEC,KAAK,EAAE;IAAG,CAAC,EAAE;MAAEC,UAAU,EAAE;IAAG,CAAC,CAAC,EACnC,CAAC;MAAEC,IAAI,EAAE;IAAG,CAAC,CAAC,EACd,CAAC;MAAEC,IAAI,EAAE,CAAC,OAAO,EAAE,KAAK,EAAE,OAAO,EAAE,MAAM;IAAE,CAAC,CAAC,EAC7C,CAAC;MAAEC,KAAK,EAAE;IAAG,CAAC,CAAC,EACf,CAAC,OAAO,CAAC;EAEjB,CAAC;EAED,MAAMC,eAAe,GAAGA,CAAC/F,CAAkC,EAAEgG,IAAU,KAAK;IACxErE,cAAc,CAACqE,IAAI,CAAC;IACpBhG,CAAC,CAACG,aAAa,CAAC8F,SAAS,CAACC,GAAG,CAAC,UAAU,CAAC;EAC7C,CAAC;EAED,MAAMC,aAAa,GAAInG,CAAkC,IAAK;IAC1DA,CAAC,CAACG,aAAa,CAAC8F,SAAS,CAAC7G,MAAM,CAAC,UAAU,CAAC;IAC5CgH,qBAAqB,CAAC9E,KAAK,CAAC;EAChC,CAAC;EAED,MAAM+E,cAAc,GAAGA,CAACrG,CAAkC,EAAEsG,MAAc,KAAK;IAC3EtG,CAAC,CAAC8C,cAAc,CAAC,CAAC;IAClB,MAAMyD,SAAS,GAAGC,KAAK,CAACC,IAAI,CAAC7H,QAAQ,CAAC8H,gBAAgB,CAAiB,mBAAmB,CAAC,CAAC;IAC5F,MAAMC,YAAY,GAAGJ,SAAS,CAACK,MAAM,CAA+C,CAACC,OAAO,EAAEC,KAAK,KAAK;MACpG,MAAMC,GAAG,GAAGD,KAAK,CAACE,qBAAqB,CAAC,CAAC;MACzC,MAAMC,MAAM,GAAGjH,CAAC,CAACkH,OAAO,GAAGH,GAAG,CAACI,GAAG,GAAGJ,GAAG,CAACK,MAAM,GAAG,CAAC;MACnD,IAAIH,MAAM,GAAG,CAAC,IAAIA,MAAM,GAAGJ,OAAO,CAACI,MAAM,EAAE,OAAO;QAAEA,MAAM;QAAEI,OAAO,EAAEP;MAAM,CAAC;MAC5E,OAAOD,OAAO;IAClB,CAAC,EAAE;MAAEI,MAAM,EAAE/G,MAAM,CAACoH;IAAkB,CAAC,CAAC,CAACD,OAAO;IAEhD,IAAIV,YAAY,IAAIjF,WAAW,EAAE;MAC7B,MAAMiB,QAAQ,GAAG,CAAC,GAAGrB,KAAK,CAAC;MAC3B,MAAMiG,QAAQ,GAAGjG,KAAK,CAACkG,SAAS,CAACC,CAAC,IAAIA,CAAC,CAACjG,EAAE,KAAKE,WAAW,CAACF,EAAE,CAAC;MAC9D,MAAMkG,QAAQ,GAAGpG,KAAK,CAACkG,SAAS,CAACC,CAAC,IAAIA,CAAC,CAACjG,EAAE,KAAKtB,MAAM,CAACyG,YAAY,CAACgB,OAAO,CAACC,MAAM,CAAC,CAAC;MACnFjF,QAAQ,CAACkF,MAAM,CAACN,QAAQ,EAAE,CAAC,CAAC;MAC5B5E,QAAQ,CAACkF,MAAM,CAACH,QAAQ,EAAE,CAAC,EAAEhG,WAAW,CAAC;MACzCH,QAAQ,CAACoB,QAAQ,CAAC;IACtB;EACJ,CAAC;EAED,MAAMyD,qBAAqB,GAAG,MAAOzD,QAAgB,IAAK;IACtDtB,YAAY,CAAC,IAAI,CAAC;IAClB,IAAI;MAAA,IAAAyG,cAAA,EAAAC,eAAA,EAAAC,qBAAA;MACA,MAAMnE,IAAI,GAAG,MAAMC,KAAK,CAAC,GAAGlH,QAAQ,cAAc,EAAE;QAChDmH,MAAM,EAAE,MAAM;QACdC,OAAO,EAAE;UAAE,cAAc,EAAE;QAAmB,CAAC;QAC/C/E,IAAI,EAAEgF,IAAI,CAACC,SAAS,CAAC;UACjBpD,IAAI,EAAE,iBAAiB;UACvBQ,KAAK,EAAEqB,QAAQ,CAACH,GAAG,CAAC,CAACiF,CAAC,EAAEQ,CAAC,MAAM;YAC3BC,QAAQ,EAAED,CAAC,GAAG,CAAC;YACfjJ,IAAI,EAAEyI,CAAC,CAACzI,IAAI;YACZyC,WAAW,EAAEgG,CAAC,CAAChG;UACnB,CAAC,CAAC;QACN,CAAC;MACL,CAAC,CAAC;MACF,IAAI,CAACoC,IAAI,CAACM,EAAE,EAAE,MAAM,IAAIC,KAAK,CAAC,QAAQP,IAAI,CAACQ,MAAM,EAAE,CAAC;MACpD,MAAMC,IAAI,GAAG,MAAMT,IAAI,CAACU,IAAI,CAAC,CAAC;MAC9B,IAAID,IAAI,CAACE,KAAK,EAAE,MAAM,IAAIJ,KAAK,CAACE,IAAI,CAACE,KAAK,CAAC;MAC3C,MAAMtB,OAA2B,IAAA4E,cAAA,GAAGxD,IAAI,CAACG,OAAO,cAAAqD,cAAA,wBAAAC,eAAA,GAAZD,cAAA,CAAe,CAAC,CAAC,cAAAC,eAAA,wBAAAC,qBAAA,GAAjBD,eAAA,CAAmB5F,OAAO,cAAA6F,qBAAA,uBAA1BA,qBAAA,CAA4B9E,OAAO;MACvE,IAAIA,OAAO,EAAE;QACT/B,cAAc,CAAC6B,IAAI,IAAI,CAAC,GAAGA,IAAI,EAAE;UAAEC,IAAI,EAAE,WAAW;UAAEC;QAAQ,CAAC,CAAC,CAAC;MACrE;IACJ,CAAC,CAAC,OAAO4B,GAAQ,EAAE;MACf3D,cAAc,CAAC6B,IAAI,IAAI,CAAC,GAAGA,IAAI,EAAE;QAAEC,IAAI,EAAE,OAAO;QAAEC,OAAO,EAAE,8BAA8B4B,GAAG,CAAC3C,OAAO;MAAG,CAAC,CAAC,CAAC;IAC9G,CAAC,SAAS;MACNd,YAAY,CAAC,KAAK,CAAC;IACvB;EACJ,CAAC;EAED,MAAM8G,iBAAiB,GAAGA,CAAA,KAAM;IAC5BhH,cAAc,CAAC6B,IAAI,IAAI,CAAC,GAAGA,IAAI,EAAE;MAAEC,IAAI,EAAE,WAAW;MAAEC,OAAO,EAAE;IAAa,CAAC,CAAC,CAAC;EACnF,CAAC;EAED,MAAMkF,aAAa,GAAGA,CAAA,KAAM;IACxBvG,aAAa,CAAC,IAAI,CAAC;IACnBV,cAAc,CAAC6B,IAAI,IAAI,CAAC,GAAGA,IAAI,EAAE;MAC7BC,IAAI,EAAE,WAAW;MACjBC,OAAO,EAAE;QAAErD,IAAI,EAAE,YAAY;QAAEwI,QAAQ,EAAE,IAAI;QAAEvH,IAAI,EAAE;MAAiB;IAC1E,CAAC,CAAC,CAAC;EACP,CAAC;EAED,MAAMwH,cAAc,GAAItI,CAAkC,IAAK;IAC3DA,CAAC,CAAC8C,cAAc,CAAC,CAAC;IAClB,MAAMyF,KAAK,GAAG/B,KAAK,CAACC,IAAI,CAACzG,CAAC,CAACwI,YAAY,CAACD,KAAK,CAAC;IAC9C,MAAME,KAAK,GAAGF,KAAK,CAACG,MAAM,CAACC,CAAC,IAAIA,CAAC,CAAC9I,IAAI,CAAC+I,UAAU,CAAC,QAAQ,CAAC,IAAID,CAAC,CAAC9I,IAAI,CAAC+I,UAAU,CAAC,QAAQ,CAAC,CAAC;IAC3FH,KAAK,CAACI,OAAO,CAAC/L,IAAI,IAAI;MAClBqE,cAAc,CAAC6B,IAAI,IAAI,CAAC,GAAGA,IAAI,EAAE;QAC7BC,IAAI,EAAE,WAAW;QACjBC,OAAO,EAAE;UACLrD,IAAI,EAAE,YAAY;UAClBiJ,QAAQ,EAAEhM,IAAI,CAAC+C,IAAI,CAAC+I,UAAU,CAAC,QAAQ,CAAC,GAAG,OAAO,GAAG,OAAO;UAC5DnJ,QAAQ,EAAE3C,IAAI,CAACkC,IAAI;UACnBlC;QACJ;MACJ,CAAC,CAAC,CAAC;IACP,CAAC,CAAC;EACN,CAAC;EAED,MAAMiM,aAAa,GAAIC,GAAgB,IAAK;IACxC,IAAI,OAAOA,GAAG,CAAC9F,OAAO,KAAK,QAAQ,EAAE;MACjC,MAAM+F,CAAM,GAAGD,GAAG,CAAC9F,OAAO;MAC1B,IAAI+F,CAAC,CAACpJ,IAAI,KAAK,WAAW,EAAE;QACxB,oBACIlD,OAAA;UAAK4C,SAAS,EAAC,YAAY;UAAAC,QAAA,gBACvB7C,OAAA;YAAK4C,SAAS,EAAC,cAAc;YAAAC,QAAA,EAAEyJ,CAAC,CAACnI;UAAI;YAAArB,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAAM,CAAC,eAC5CjD,OAAA;YAAK4C,SAAS,EAAC,iBAAiB;YAAAC,QAAA,EAC3ByJ,CAAC,CAAC3H,KAAK,CAACkB,GAAG,CAAC,CAACwD,IAAU,EAAEpD,KAAa,kBACnCjG,OAAA;cAAK4C,SAAS,EAAC,UAAU;cAAAC,QAAA,gBACrB7C,OAAA;gBAAK4C,SAAS,EAAC,aAAa;gBAAAC,QAAA,GAAC,OAAK,EAACoD,KAAK,GAAG,CAAC;cAAA;gBAAAnD,QAAA,EAAAC,YAAA;gBAAAC,UAAA;gBAAAC,YAAA;cAAA,OAAM,CAAC,eACnDjD,OAAA;gBACI4C,SAAS,EAAC,kBAAkB;gBAC5B2J,SAAS;gBACT,gBAAclD,IAAI,CAACxE,EAAG;gBACtB2H,WAAW,EAAGnJ,CAAC,IAAK+F,eAAe,CAAC/F,CAAC,EAAEgG,IAAI,CAAE;gBAC7CoD,SAAS,EAAEjD,aAAc;gBACzBkD,UAAU,EAAGrJ,CAAC,IAAKqG,cAAc,CAACrG,CAAC,EAAE4C,KAAK,CAAE;gBAAApD,QAAA,gBAE5C7C,OAAA;kBAAK4C,SAAS,EAAC,WAAW;kBAAAC,QAAA,EAAEwG,IAAI,CAAChH;gBAAI;kBAAAS,QAAA,EAAAC,YAAA;kBAAAC,UAAA;kBAAAC,YAAA;gBAAA,OAAM,CAAC,eAC5CjD,OAAA;kBAAK4C,SAAS,EAAC,kBAAkB;kBAAAC,QAAA,EAAEwG,IAAI,CAACvE;gBAAW;kBAAAhC,QAAA,EAAAC,YAAA;kBAAAC,UAAA;kBAAAC,YAAA;gBAAA,OAAM,CAAC;cAAA;gBAAAH,QAAA,EAAAC,YAAA;gBAAAC,UAAA;gBAAAC,YAAA;cAAA,OACzD,CAAC;YAAA,GAZqBoG,IAAI,CAACxE,EAAE;cAAA/B,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OAajC,CACR;UAAC;YAAAH,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OACD,CAAC,eACNjD,OAAA;YAAK4C,SAAS,EAAC,gBAAgB;YAAAC,QAAA,gBAC3B7C,OAAA;cAAQ4C,SAAS,EAAC,mBAAmB;cAACa,OAAO,EAAE+H,iBAAkB;cAAA3I,QAAA,EAAC;YAAE;cAAAC,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OAAQ,CAAC,EAC5E,CAACgC,UAAU,gBACRjF,OAAA;cAAQ4C,SAAS,EAAC,oBAAoB;cAACa,OAAO,EAAEgI,aAAc;cAAA5I,QAAA,EAAC;YAAE;cAAAC,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OAAQ,CAAC,gBAE1EjD,OAAA;cAAQ4C,SAAS,EAAC,iBAAiB;cAACa,OAAO,EAAEgI,aAAc;cAAA5I,QAAA,EAAC;YAAG;cAAAC,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OAAQ,CAC1E;UAAA;YAAAH,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OACA,CAAC;QAAA;UAAAH,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OACL,CAAC;MAEd,CAAC,MAAM,IAAIqJ,CAAC,CAACpJ,IAAI,KAAK,YAAY,EAAE;QAChC,IAAIoJ,CAAC,CAACZ,QAAQ,EAAE;UACZ,oBACI1L,OAAA;YAAK4C,SAAS,EAAC,aAAa;YAAAC,QAAA,eACxB7C,OAAA;cAAK4C,SAAS,EAAC,UAAU;cAAAC,QAAA,eAAC7C,OAAA;gBAAA6C,QAAA,EAAIyJ,CAAC,CAACnI;cAAI;gBAAArB,QAAA,EAAAC,YAAA;gBAAAC,UAAA;gBAAAC,YAAA;cAAA,OAAI;YAAC;cAAAH,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OAAK;UAAC;YAAAH,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAC9C,CAAC;QAEd;QACA,oBACIjD,OAAA;UAAK4C,SAAS,EAAC,aAAa;UAAAC,QAAA,EACvByJ,CAAC,CAACH,QAAQ,KAAK,OAAO,gBACnBnM,OAAA,CAACE,WAAW;YAACC,IAAI,EAAEmM,CAAC,CAACnM;UAAK;YAAA2C,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAAE,CAAC,gBAE7BjD,OAAA;YAAK4C,SAAS,EAAC,cAAc;YAAAC,QAAA,eACzB7C,OAAA;cAAO2M,QAAQ;cAAA9J,QAAA,gBACX7C,OAAA;gBAAQ+D,GAAG,EAAEjC,GAAG,CAACC,eAAe,CAACuK,CAAC,CAACnM,IAAI,CAAE;gBAAC+C,IAAI,EAAEoJ,CAAC,CAACnM,IAAI,CAAC+C;cAAK;gBAAAJ,QAAA,EAAAC,YAAA;gBAAAC,UAAA;gBAAAC,YAAA;cAAA,OAAE,CAAC,oDAEnE;YAAA;cAAAH,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OAAO;UAAC;YAAAH,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OACP;QACR;UAAAH,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OACA,CAAC;MAEd,CAAC,MAAM,IAAIqJ,CAAC,CAACpJ,IAAI,KAAK,YAAY,EAAE;QAChC,oBACIlD,OAAA;UAAK4C,SAAS,EAAC,kBAAkB;UAAAC,QAAA,gBAC7B7C,OAAA;YAAK4C,SAAS,EAAC,kBAAkB;YAAAC,QAAA,EAAEyJ,CAAC,CAAC5I;UAAK;YAAAZ,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAAM,CAAC,eACjDjD,OAAA;YAAK4C,SAAS,EAAC,iBAAiB;YAAAC,QAAA,EAAEyJ,CAAC,CAACnI;UAAI;YAAArB,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAAM,CAAC;QAAA;UAAAH,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAC9C,CAAC;MAEd;MACA,OAAOqE,IAAI,CAACC,SAAS,CAAC8E,GAAG,CAAC9F,OAAO,CAAC;IACtC;IACA,OAAO8F,GAAG,CAAC9F,OAAO;EACtB,CAAC;EAED,oBACIvG,OAAA;IAAK4C,SAAS,EAAC,KAAK;IAAAC,QAAA,eAChB7C,OAAA;MAAK4C,SAAS,EAAC,WAAW;MAAAC,QAAA,gBACtB7C,OAAA;QAAK4C,SAAS,EAAC,gBAAgB;QAAAC,QAAA,eAC3B7C,OAAA,CAACF,UAAU;UACP8M,KAAK,EAAC,MAAM;UACZzJ,KAAK,EAAEgB,IAAK;UACZf,QAAQ,EAAEgB,OAAQ;UAClBwE,OAAO,EAAEA,OAAQ;UACjBhG,SAAS,EAAC,kBAAkB;UAC5BiK,WAAW,EAAC;QAAyB;UAAA/J,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OACxC;MAAC;QAAAH,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OACD,CAAC,eAENjD,OAAA;QACI4C,SAAS,EAAE,gBAAgBuC,UAAU,GAAG,UAAU,GAAG,EAAE,EAAG;QAC1DuH,UAAU,EAAGrJ,CAAC,IAAK;UAAEA,CAAC,CAAC8C,cAAc,CAAC,CAAC;UAAEf,aAAa,CAAC,IAAI,CAAC;QAAE,CAAE;QAChE0H,WAAW,EAAEA,CAAA,KAAM1H,aAAa,CAAC,KAAK,CAAE;QACxC2H,MAAM,EAAG1J,CAAC,IAAK;UAAE+B,aAAa,CAAC,KAAK,CAAC;UAAEuG,cAAc,CAACtI,CAAC,CAAC;QAAE,CAAE;QAAAR,QAAA,gBAE5D7C,OAAA;UAAK4C,SAAS,EAAC,cAAc;UAAAC,QAAA,GACxB0B,WAAW,CAACsB,GAAG,CAAC,CAACwG,GAAG,EAAEpG,KAAK,kBACxBjG,OAAA;YAAiB4C,SAAS,EAAE,gBAAgByJ,GAAG,CAAC/F,IAAI,EAAG;YAAAzD,QAAA,eACnD7C,OAAA;cAAK4C,SAAS,EAAC,iBAAiB;cAAAC,QAAA,EAAEuJ,aAAa,CAACC,GAAG;YAAC;cAAAvJ,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OAAM;UAAC,GADrDgD,KAAK;YAAAnD,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAEV,CACR,CAAC,EACDwB,SAAS,iBAAIzE,OAAA;YAAK4C,SAAS,EAAC,SAAS;YAAAC,QAAA,EAAC;UAAkB;YAAAC,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAAK,CAAC;QAAA;UAAAH,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAC9D,CAAC,eACNjD,OAAA;UAAMgN,QAAQ,EAAE9G,gBAAiB;UAACtD,SAAS,EAAC,iBAAiB;UAAAC,QAAA,gBACzD7C,OAAA;YACIkD,IAAI,EAAC,MAAM;YACXC,KAAK,EAAEkB,SAAU;YACjBjB,QAAQ,EAAGC,CAAC,IAAKiB,YAAY,CAACjB,CAAC,CAAC4J,MAAM,CAAC9J,KAAK,CAAE;YAC9C0J,WAAW,EAAC,kBAAkB;YAC9BjK,SAAS,EAAC;UAAY;YAAAE,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OACzB,CAAC,eACFjD,OAAA;YAAQkD,IAAI,EAAC,QAAQ;YAACN,SAAS,EAAC,aAAa;YAAAC,QAAA,EAAC;UAAI;YAAAC,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAAQ,CAAC;QAAA;UAAAH,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OACzD,CAAC;MAAA;QAAAH,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OACN,CAAC;IAAA;MAAAH,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OACL;EAAC;IAAAH,QAAA,EAAAC,YAAA;IAAAC,UAAA;IAAAC,YAAA;EAAA,OACL,CAAC;AAEd;AAACiB,GAAA,CApUuBD,GAAG;AAAAiJ,GAAA,GAAHjJ,GAAG;AAAA,IAAAD,EAAA,EAAAkJ,GAAA;AAAAC,YAAA,CAAAnJ,EAAA;AAAAmJ,YAAA,CAAAD,GAAA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}